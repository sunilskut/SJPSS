<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Back! âœ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'slide-in': 'slideIn 0.8s ease-out forwards',
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'slide-out-left': 'slideOutLeft 0.6s ease-in forwards',
                        'slide-in-right': 'slideInRight 0.8s ease-out forwards',
                        'bounce-gentle': 'bounceGentle 0.6s ease-out',
                        'pulse-success': 'pulseSuccess 0.4s ease-out',
                        'confetti-fall': 'confettiFall 3s ease-out forwards',
                        'confetti-spin': 'confettiSpin 3s linear infinite',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { 
                                transform: 'translateY(20px)', 
                                opacity: '0' 
                            },
                            '100%': { 
                                transform: 'translateY(0)', 
                                opacity: '1' 
                            }
                        },
                        fadeIn: {
                            '0%': { 
                                opacity: '0', 
                                transform: 'scale(0.9)' 
                            },
                            '100%': { 
                                opacity: '1', 
                                transform: 'scale(1)' 
                            }
                        },
                        slideOutLeft: {
                            '0%': { 
                                transform: 'translateX(0) scale(1)', 
                                opacity: '1' 
                            },
                            '100%': { 
                                transform: 'translateX(-100%) scale(0.8)', 
                                opacity: '0' 
                            }
                        },
                        slideInRight: {
                            '0%': { 
                                transform: 'translateX(100%) scale(0.8)', 
                                opacity: '0' 
                            },
                            '100%': { 
                                transform: 'translateX(0) scale(1)', 
                                opacity: '1' 
                            }
                        },
                        bounceGentle: {
                            '0%, 100%': { 
                                transform: 'translateY(0)' 
                            },
                            '50%': { 
                                transform: 'translateY(-10px)' 
                            }
                        },
                        pulseSuccess: {
                            '0%': { 
                                transform: 'scale(1)' 
                            },
                            '50%': { 
                                transform: 'scale(1.05)' 
                            },
                            '100%': { 
                                transform: 'scale(1)' 
                            }
                        },
                        confettiFall: {
                            '0%': {
                                transform: 'translateY(-10px) rotate(0deg)',
                                opacity: '1'
                            },
                            '100%': {
                                transform: 'translateY(100vh) rotate(720deg)',
                                opacity: '0'
                            }
                        },
                        confettiSpin: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' }
                        }
                    },
                    backdropBlur: {
                        'xs': '2px',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        .success-gradient {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .error-gradient {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .logout-gradient {
            background: linear-gradient(135deg, #87CEFA 0%, #00BFFF 100%);
        }
        
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.9;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 50px)) rotate(720deg);
                opacity: 0;
            }
        }
        
        .form-transition-out {
            animation: slideOutLeft 0.6s ease-in forwards;
        }
        
        .welcome-transition-in {
            animation: slideInRight 0.8s ease-out forwards;
        }
        
        .success-pulse {
            animation: pulseSuccess 0.4s ease-out;
        }
        
        .gentle-bounce {
            animation: bounceGentle 0.6s ease-out;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-5" oncontextmenu="return false;" onkeydown="if(event.keyCode==123) return false;">
    <div class="glass-morphism rounded-3xl p-10 w-full max-w-md shadow-2xl animate-slide-in">
        <!-- Login Form -->
        <div id="loginForm" class="login-form">
            <div class="text-center mb-8">
                <h1 id="LoginPageHeading" class="text-gray-800 text-2xl font-semibold mb-2 flex items-center justify-center">
                    Welcome Back! âœ¨
                </h1>
                <p class="text-gray-600 text-base">Please sign in to your account</p>
            </div>
            
            <form id="loginFormElement" class="space-y-6">
                <div class="space-y-2">
                    <label for="username" class="block text-gray-700 font-medium text-sm transition-all duration-300">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-base transition-all duration-500 bg-gray-50 hover:bg-white hover:border-gray-300 focus:bg-white focus:border-indigo-500 focus:outline-none input-focus transform hover:-translate-y-0.5 focus:-translate-y-1 hover:shadow-md focus:shadow-lg"
                    >
                </div>
                
                <div class="space-y-2">
                    <label for="password" class="block text-gray-700 font-medium text-sm transition-all duration-300">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-base transition-all duration-500 bg-gray-50 hover:bg-white hover:border-gray-300 focus:bg-white focus:border-indigo-500 focus:outline-none input-focus transform hover:-translate-y-0.5 focus:-translate-y-1 hover:shadow-md focus:shadow-lg"
                    >
                </div>
                
                <button 
                    type="submit" 
                    class="w-full py-3.5 gradient-btn text-white border-none rounded-xl text-base font-semibold cursor-pointer transition-all duration-500 relative overflow-hidden hover:transform hover:-translate-y-1 hover:shadow-2xl active:transform active:translate-y-0 disabled:pointer-events-none hover:scale-105 active:scale-95" 
                    id="loginBtn"
                >
                    <span id="btnText" class="transition-all duration-300">Sign In</span>
                </button>
            </form>
            
            <div id="message" class="mt-5 px-4 py-3 rounded-lg text-center font-medium opacity-0 transform translate-y-2 transition-all duration-300 hidden"></div>
        </div>
        
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="welcome-screen text-center hidden">
            <h1 class="text-gray-800 text-4xl font-bold mb-5 gentle-bounce">ðŸŽ‰ Welcome!</h1>
            <p class="text-gray-600 text-lg mb-8 transition-all duration-500">You have successfully logged in!</p>
            <button 
                class="px-6 py-2.5 logout-gradient text-white border-none rounded-lg cursor-pointer font-medium transition-all duration-300 hover:transform hover:-translate-y-1 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl" 
                onclick="logout()"
            >
                Proceed
            </button>
        </div>
    </div>

    <!-- Confetti Container -->
    <div id="confettiContainer" class="confetti-container"></div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB3iBWleWNMCdQS9F0HR1wHBBtHkeMawhg",
            authDomain: "sjpss-f504b.firebaseapp.com",
            projectId: "sjpss-f504b",
            storageBucket: "sjpss-f504b.firebasestorage.app",
            messagingSenderId: "227402980311",
            appId: "1:227402980311:web:56b580456ab6b9c6758992",
            measurementId: "G-LZ4YP9YPN6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM elements
        const loginForm = document.getElementById('loginFormElement');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const messageDiv = document.getElementById('message');
        const loginFormDiv = document.getElementById('loginForm');
        const welcomeScreen = document.getElementById('welcomeScreen');
        let role = "";
        let userId = "";

        // Login function
        async function authenticateUser(username, password) {
            try {
                // Query Firestore for user with matching username
                const usersRef = db.collection('users');
                const query = usersRef.where('username', '==', username);
                const snapshot = await query.get();

                if (snapshot.empty) {
                    return { success: false, message: "Oops! User not found ðŸ”" };
                }

                let userFound = false;
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    if (userData.password === password) {
                        userFound = true;
                        role = userData.role;
                        userId = userData.id;
                        if (role === 'deliveryStaff') {
                            window.location = `deliveryStaffPage.html?staffId=${userData.id}`;
                        }
                        sessionStorage.setItem('userRole', role);
                        sessionStorage.setItem('userId', userId);
                    }
                });

                if (userFound) {
                    return { success: true, message: "Welcome back! ðŸŽ‰" };
                } else {
                    return { success: false, message: "Hmm, that password doesn't look right ðŸ¤”" };
                }
            } catch (error) {
                console.error('Authentication error:', error);
                return { success: false, message: "Something went wrong. Please try again! ðŸ˜…" };
            }
        }

        // Show message function with enhanced transitions
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = `mt-5 px-4 py-3 rounded-lg text-center font-medium transition-all duration-500 text-white transform ${type === 'success' ? 'success-gradient' : 'error-gradient'}`;
            messageDiv.classList.remove('hidden', 'opacity-0', 'translate-y-2', 'scale-95');
            messageDiv.classList.add('opacity-100', 'translate-y-0', 'scale-100');
            
            if (type === 'success') {
                messageDiv.classList.add('success-pulse');
                // Trigger confetti for success
                createConfetti();
            }
            
            setTimeout(() => {
                messageDiv.classList.remove('opacity-100', 'translate-y-0', 'scale-100', 'success-pulse');
                messageDiv.classList.add('opacity-0', 'translate-y-2', 'scale-95');
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 500);
            }, 3000);
        }

        // Create confetti animation
        function createConfetti() {
            const confettiContainer = document.getElementById('confettiContainer');
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                
                // Random shapes
                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                } else {
                    confetti.style.transform = 'rotate(45deg)';
                }
                
                // Apply animation with random delay and duration
                const duration = 2 + Math.random() * 2; // 2-4 seconds
                const delay = Math.random() * 0.5; // 0-0.5 second delay
                
                confetti.style.animation = `confettiFall ${duration}s ease-in ${delay}s forwards`;
                
                confettiContainer.appendChild(confetti);
                
                // Remove confetti after animation completes
                setTimeout(() => {
                    if (confetti && confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, (duration + delay + 0.5) * 1000);
            }
        }

        // Form submit handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showMessage("Please fill in all fields! ðŸ“", "error");
                return;
            }

            // Show loading state
            loginBtn.classList.add('loading-spinner');
            loginBtn.disabled = true;
            btnText.textContent = '';

            try {
                const result = await authenticateUser(username, password);
                
                if (result.success) {
                    // Add success animation to button
                    loginBtn.classList.add('success-pulse');
                    showMessage(result.message, "success");
                    
                    // Enhanced transition to welcome screen
                    setTimeout(() => {
                        loginFormDiv.classList.add('form-transition-out');
                        
                        setTimeout(() => {
                            loginFormDiv.classList.add('hidden');
                            welcomeScreen.classList.remove('hidden');
                            welcomeScreen.classList.add('welcome-transition-in');
                        }, 600);
                    }, 1500);
                } else {
                    showMessage(result.message, "error");
                }
            } catch (error) {
                showMessage("Oops! Something unexpected happened ðŸ˜…", "error");
            } finally {
                // Reset loading state with smooth transition
                setTimeout(() => {
                    loginBtn.classList.remove('loading-spinner', 'success-pulse');
                    loginBtn.disabled = false;
                    btnText.textContent = 'Sign In';
                }, 500);
            }
        });

        // Logout function
        function logout() { 
            sessionStorage.setItem('isLogin', 'true');
            window.location.href = `adminPanel.html?role=${role}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const heading = document.getElementById('LoginPageHeading');
            sessionStorage.removeItem('isLogin');

            if (!heading) return;

            // Create the image element
            const img = document.createElement('img');
            img.src = "https://live.staticflickr.com/65535/54681641143_f57882f96a_n.jpg";
            img.width = 25;
            img.height = 25;
            img.className = "inline-block mr-2 align-middle";

            // Insert image before the heading text
            heading.prepend(img);
        });
    </script>
</body>
</html>
