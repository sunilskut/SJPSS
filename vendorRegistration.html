<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Registration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-functions-compat.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'spin-slow': 'spin 2s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-500 via-purple-600 to-indigo-700">
    <div class="min-h-screen p-4 md:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden animate-fade-in">
            <!-- Header -->
            <div class="bg-gradient-to-r from-slate-800 via-blue-600 to-blue-700 text-white p-6 md:p-8 lg:p-12">
                <div class="text-center">
                    <div class="flex items-center justify-between mb-3 md:mb-4">
                        <a href="adminPanel.html#vendors" class="group inline-flex items-center px-4 py-2 text-sm font-medium text-blue-100 bg-white/10 border border-white/20 rounded-lg hover:bg-white/20 hover:text-white transition-all duration-200 backdrop-blur-sm">
                            <svg class="w-4 h-4 mr-2 transition-transform duration-200 group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            <span>Admin Panel</span>
                        </a>
                        <h1 class="text-3xl md:text-4xl lg:text-5xl font-light">
                            <i class="fas fa-store mr-3"></i>Vendor Management System
                        </h1>
                        <div class="w-32"></div>
                    </div>
                    <p class="text-blue-100 text-lg md:text-xl opacity-90">
                        Create and manage vendor profiles with secure data
                    </p>
                </div>
            </div>

            <div class="p-4 md:p-6 lg:p-8">
                <!-- Security Notice -->
                <div class="bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-2xl p-4 md:p-6 mb-6 md:mb-8 animate-slide-up">
                    <h3 class="text-lg md:text-xl font-semibold mb-2 flex items-center">
                        <i class="fas fa-shield-alt mr-3"></i>Security Notice
                    </h3>
                    <p class="text-pink-100 text-sm md:text-base">
                        All sensitive data including bank information, identity documents, and passwords are handled securely. 
                        Bank details are masked, passwords are hashed, and GST/PAN validation is applied automatically.
                    </p>
                </div>

                <!-- Main Form -->
                <div class="bg-gray-50 rounded-2xl p-4 md:p-6 lg:p-8 mb-6 md:mb-8 animate-slide-up">
                    <form id="vendorForm" class="space-y-8 md:space-y-12">

                        <!-- Basic Information Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-blue-500 flex items-center">
                                <i class="fas fa-user mr-3 text-blue-500"></i>Basic Information
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
                                <div class="space-y-2">
                                    <label for="name" class="block text-sm font-medium text-gray-700">
                                        Vendor Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="name" name="name" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="email" class="block text-sm font-medium text-gray-700">
                                        Email <span class="text-red-500">*</span>
                                    </label>
                                    <input type="email" id="email" name="email" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="phone" class="block text-sm font-medium text-gray-700">
                                        Phone Number <span class="text-red-500">*</span>
                                    </label>
                                    <input type="tel" id="phone" name="phone" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white">
                                </div>
                             
			       	<div class="space-y-2 md:col-span-2 xl:col-span-1">
                                    <label for="password" class="block text-sm font-medium text-gray-700">
                                        Username (login enabled) <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="username" name="username" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white">
                                </div>
				 <div class="space-y-2 md:col-span-2 xl:col-span-1">
                                    <label for="password" class="block text-sm font-medium text-gray-700">
                                        Password (login enabled) <span class="text-red-500">*</span>
                                    </label>
                                    <input type="password" id="password" name="password" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 bg-white">
                                </div>

                            </div>
                        </section>

                        <!-- Business Information Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-green-500 flex items-center">
                                <i class="fas fa-building mr-3 text-green-500"></i>Business Information
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
                                <div class="space-y-2">
                                    <label for="companyName" class="block text-sm font-medium text-gray-700">
                                        Company Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="companyName" name="companyName" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="gstNumber" class="block text-sm font-medium text-gray-700">GST Number</label>
                                    <input type="text" id="gstNumber" name="gstNumber" 
                                           pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}" 
                                           placeholder="22AAAAA0000A1Z5"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="panNumber" class="block text-sm font-medium text-gray-700">PAN Number</label>
                                    <input type="text" id="panNumber" name="panNumber" 
                                           pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" 
                                           placeholder="ABCDE1234F"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="businessType" class="block text-sm font-medium text-gray-700">Business Type</label>
                                    <select id="businessType" name="businessType"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all duration-200 bg-white">
                                        <option value="">Select Business Type</option>
                                        <option value="sole_proprietorship">Sole Proprietorship</option>
                                        <option value="partnership">Partnership</option>
                                        <option value="llp">Limited Liability Partnership</option>
                                        <option value="private_limited">Private Limited Company</option>
                                        <option value="public_limited">Public Limited Company</option>
                                    </select>
                                </div>
                                <div class="space-y-2 md:col-span-2">
                                    <label for="registrationCertificateUrl" class="block text-sm font-medium text-gray-700">
                                        Registration Certificate URL (Optional)
                                    </label>
                                    <input type="url" id="registrationCertificateUrl" name="registrationCertificateUrl"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all duration-200 bg-white">
                                </div>
                            </div>
                        </section>

                        <!-- Address Information Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-purple-500 flex items-center">
                                <i class="fas fa-map-marker-alt mr-3 text-purple-500"></i>Address Information
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
                                <div class="space-y-2 md:col-span-2">
                                    <label for="addressLine1" class="block text-sm font-medium text-gray-700">
                                        Address Line 1 <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="addressLine1" name="addressLine1" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="addressLine2" class="block text-sm font-medium text-gray-700">Address Line 2</label>
                                    <input type="text" id="addressLine2" name="addressLine2"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="city" class="block text-sm font-medium text-gray-700">
                                        City <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="city" name="city" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="state" class="block text-sm font-medium text-gray-700">
                                        State <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="state" name="state" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="postalCode" class="block text-sm font-medium text-gray-700">
                                        Postal Code <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="postalCode" name="postalCode" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="country" class="block text-sm font-medium text-gray-700">
                                        Country <span class="text-red-500">*</span>
                                    </label>
                                    <select id="country" name="country" required
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all duration-200 bg-white">
                                        <option value="">Select Country</option>
                                        <option value="IN" selected>India</option>
                                        <option value="US">United States</option>
                                    </select>
                                </div>
                            </div>
                        </section>

                        <!-- Payment Information Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-yellow-500 flex items-center">
                                <i class="fas fa-university mr-3 text-yellow-500"></i>Payment Information
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
                                <div class="space-y-2">
                                    <label for="bankAccountNumber" class="block text-sm font-medium text-gray-700">Bank Account Number</label>
                                    <input type="text" id="bankAccountNumber" name="bankAccountNumber"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="ifscCode" class="block text-sm font-medium text-gray-700">IFSC Code</label>
                                    <input type="text" id="ifscCode" name="ifscCode" 
                                           pattern="[A-Z]{4}0[A-Z0-9]{6}" 
                                           placeholder="SBIN0001234"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="upiId" class="block text-sm font-medium text-gray-700">UPI ID</label>
                                    <input type="text" id="upiId" name="upiId" placeholder="vendor@paytm"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-3 pt-8">
                                        <input type="checkbox" id="paymentVerified" name="paymentVerified"
                                               class="w-5 h-5 text-yellow-500 bg-gray-100 border-gray-300 rounded focus:ring-yellow-500 focus:ring-2">
                                        <label for="paymentVerified" class="text-sm font-medium text-gray-700">
                                            Payment Details Verified
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Status and Settings Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-red-500 flex items-center">
                                <i class="fas fa-flag mr-3 text-red-500"></i>Status & Settings
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-6">
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" id="isActive" name="isActive" checked
                                               class="w-5 h-5 text-red-500 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2">
                                        <label for="isActive" class="text-sm font-medium text-gray-700">Active Vendor</label>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" id="isVerified" name="isVerified"
                                               class="w-5 h-5 text-red-500 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2">
                                        <label for="isVerified" class="text-sm font-medium text-gray-700">KYC/Business Verified</label>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="rating" class="block text-sm font-medium text-gray-700">Rating (0-5)</label>
                                    <input type="number" id="rating" name="rating" min="0" max="5" step="0.1" value="0"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="totalProducts" class="block text-sm font-medium text-gray-700">Total Products</label>
                                    <input type="number" id="totalProducts" name="totalProducts" min="0" value="0"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all duration-200 bg-white">
                                </div>
                            </div>
                        </section>

                        <!-- Additional Information Section -->
                        <section class="space-y-4 md:space-y-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-gray-800 pb-3 border-b-4 border-indigo-500 flex items-center">
                                <i class="fas fa-plus-circle mr-3 text-indigo-500"></i>Additional Information (Optional)
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6">
                                <div class="space-y-2">
                                    <label for="profileImageUrl" class="block text-sm font-medium text-gray-700">Profile Image URL</label>
                                    <input type="url" id="profileImageUrl" name="profileImageUrl"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="supportContact" class="block text-sm font-medium text-gray-700">Support Contact</label>
                                    <input type="text" id="supportContact" name="supportContact"
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white">
                                </div>
                                <div class="space-y-2">
                                    <label for="preferredCourierService" class="block text-sm font-medium text-gray-700">Preferred Courier Service</label>
                                    <select id="preferredCourierService" name="preferredCourierService"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white">
                                        <option value="">Select Courier</option>
                                        <option value="bluedart">Blue Dart</option>
                                        <option value="dhl">DHL</option>
                                        <option value="fedex">FedEx</option>
                                        <option value="dtdc">DTDC</option>
                                        <option value="indiapost">India Post</option>
                                    </select>
                                </div>
                                <div class="space-y-2 md:col-span-2 xl:col-span-1">
                                    <label for="deliveryZones" class="block text-sm font-medium text-gray-700">Delivery Zones (comma-separated)</label>
                                    <textarea id="deliveryZones" name="deliveryZones" rows="3" 
                                              placeholder="Trivandrum District"
                                              class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white resize-none"></textarea>
                                </div>
                                <div class="space-y-2 md:col-span-2">
                                    <label for="warehouseLocations" class="block text-sm font-medium text-gray-700">Warehouse Locations</label>
                                    <textarea id="warehouseLocations" name="warehouseLocations" rows="3"
                                              placeholder="Main Warehouse: Address 1, Secondary: Address 2"
                                              class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white resize-none"></textarea>
                                </div>
                                <div class="space-y-2 md:col-span-2 xl:col-span-3">
                                    <label for="notes" class="block text-sm font-medium text-gray-700">Admin Notes</label>
                                    <textarea id="notes" name="notes" rows="3"
                                              placeholder="Internal notes or remarks"
                                              class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-200 bg-white resize-none"></textarea>
                                </div>
                            </div>
                        </section>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 justify-center pt-6">
                            <button type="submit" 
                                    class="px-8 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 focus:ring-4 focus:ring-blue-100 transition-all duration-200 transform hover:scale-105 flex items-center justify-center font-semibold text-lg shadow-lg">
                                <i class="fas fa-save mr-3"></i>Create Vendor
                            </button>
                            <button type="button" onclick="formManager.clearForm()"
                                    class="px-8 py-4 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-xl hover:from-gray-600 hover:to-gray-700 focus:ring-4 focus:ring-gray-100 transition-all duration-200 transform hover:scale-105 flex items-center justify-center font-semibold text-lg shadow-lg">
                                <i class="fas fa-eraser mr-3"></i>Clear Form
                            </button>
                            <button type="button" onclick="vendorOperations.loadVendors()"
                                    class="px-8 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl hover:from-orange-600 hover:to-orange-700 focus:ring-4 focus:ring-orange-100 transition-all duration-200 transform hover:scale-105 flex items-center justify-center font-semibold text-lg shadow-lg">
                                <i class="fas fa-list mr-3"></i>Load Vendors
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Vendor List Section -->
                <div id="vendorList" class="hidden bg-white rounded-2xl p-4 md:p-6 lg:p-8 animate-slide-up">
                    <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 pb-4 border-b-4 border-green-500 flex items-center mb-6">
                        <i class="fas fa-users mr-3 text-green-500"></i>Existing Vendors
                    </h2>
                    <div id="vendorCards" class="space-y-4 md:space-y-6"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Production-ready vendor management script

        const firebaseConfig = {
            apiKey: "AIzaSyB3iBWleWNMCdQS9F0HR1wHBBtHkeMawhg",
            authDomain: "sjpss-f504b.firebaseapp.com",
            projectId: "sjpss-f504b",
            storageBucket: "sjpss-f504b.firebasestorage.app",
            messagingSenderId: "227402980311",
            appId: "1:227402980311:web:56b580456ab6b9c6758992",
            measurementId: "G-LZ4YP9YPN6"
        };

        // Global variables
        let db;
        let editingVendorId = null;
        let isFormSubmitting = false;

        // Initialize Firebase
        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.firestore();

                // Enable offline persistence with error handling
                db.enablePersistence().catch((err) => {
                    if (err.code === 'failed-precondition') {
                        console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time.');
                    } else if (err.code === 'unimplemented') {
                        console.warn('The current browser does not support persistence.');
                    }
                    utils.showNotification('Offline support is limited', 'error');
                });

                return true;
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                utils.showNotification('Database connection failed. Please try again later.', 'error');
                return false;
            }
        }

        // Utility Functions
        const utils = {
            sanitizeInput: (input) => {
                if (typeof input !== 'string') return input;
                return input.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
            },

            showNotification: (message, type = 'success') => {
                const container = document.getElementById('notificationContainer');
                if (!container) return;

                const notification = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                const icon = type === 'success' ? 'check-circle' : 'exclamation-circle';

                notification.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 flex items-center space-x-3 max-w-sm`;

                const sanitizedMessage = utils.sanitizeInput(message);

                notification.innerHTML = `
                    <i class="fas fa-${icon}" aria-hidden="true"></i>
                    <span class="font-medium">${sanitizedMessage}</span>
                    <button type="button" onclick="this.parentElement.remove()" class="ml-auto text-white hover:text-gray-200" aria-label="Close notification">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                `;

                container.appendChild(notification);

                setTimeout(() => notification.classList.remove('translate-x-full'), 100);

                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.classList.add('translate-x-full');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            },

            validateGST: (gstNumber) => {
                const gstRegex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
                return gstRegex.test(gstNumber);
            },

            validatePAN: (panNumber) => {
                const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                return panRegex.test(panNumber);
            },

            validateIFSC: (ifscCode) => {
                const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;
                return ifscRegex.test(ifscCode);
            },

            validateEmail: (email) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            },

            validatePhone: (phone) => {
                const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
                return phoneRegex.test(phone.replace(/[-\s]/g, ''));
            },

            generateVendorId: () => {
                const timestamp = Date.now().toString(36);
                const randomStr = Math.random().toString(36).substring(2, 8);
                return `VEN_${timestamp}_${randomStr}`.toUpperCase();
            },

            formatCurrency: (amount) => {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR'
                }).format(amount);
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            hashPassword: async (password) => {
                // Simple hash for client-side (in production, use server-side hashing)
                const encoder = new TextEncoder();
                const data = encoder.encode(password + 'vendor_salt_2024');
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }
        };

        // Form Management
        const formManager = {
            clearForm: () => {
                const form = document.getElementById('vendorForm');
                if (!form) return;

                form.reset();
                editingVendorId = null;
                isFormSubmitting = false;

                // Reset country to India
                const countrySelect = document.getElementById('country');
                if (countrySelect) {
                    countrySelect.value = 'IN';
                }

                const submitBtn = document.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-save mr-3" aria-hidden="true"></i>Create Vendor';
                    submitBtn.disabled = false;
                }

                // Reset field borders
                form.querySelectorAll('input, select, textarea').forEach(element => {
                    element.classList.remove('border-red-500', 'border-green-500');
                    element.classList.add('border-gray-200');
                });

                utils.showNotification('Form cleared');
            },

            populateForm: (vendor) => {
                const form = document.getElementById('vendorForm');
                if (!form || !vendor) return;

                try {
                    Object.keys(vendor).forEach(key => {
                        const element = form.elements[key];
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = Boolean(vendor[key]);
                            } else if (key !== 'passwordHash' && key !== 'createdAt' && key !== 'updatedAt') {
                                // Handle array fields
                                if (Array.isArray(vendor[key])) {
                                    element.value = vendor[key].join(', ');
                                } else {
                                    element.value = utils.sanitizeInput(vendor[key]) || '';
                                }
                            }
                        }
                    });

                    editingVendorId = vendor.vendorId || vendor.id;
                    const submitBtn = document.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-edit mr-3" aria-hidden="true"></i>Update Vendor';
                    }

                    utils.showNotification('Vendor loaded for editing');
                } catch (error) {
                    console.error('Error populating form:', error);
                    utils.showNotification('Error loading vendor data', 'error');
                }
            },

            validateForm: (formData) => {
                const errors = [];

                // Required fields validation
                const requiredFields = ['name', 'email', 'phone', 'companyName', 'addressLine1', 'city', 'state', 'postalCode', 'country'];
                requiredFields.forEach(field => {
                    const value = formData.get(field);
                    if (!value || !value.trim()) {
                        errors.push(`${field.charAt(0).toUpperCase() + field.slice(1)} is required`);
                    }
                });

                // Email validation
                const email = formData.get('email');
                if (email && !utils.validateEmail(email)) {
                    errors.push('Invalid email format');
                }

                // Phone validation
                const phone = formData.get('phone');
                if (phone && !utils.validatePhone(phone)) {
                    errors.push('Invalid phone number format');
                }

                // GST validation (optional)
                const gstNumber = formData.get('gstNumber');
                if (gstNumber && !utils.validateGST(gstNumber)) {
                    errors.push('Invalid GST number format');
                }

                // PAN validation (optional)
                const panNumber = formData.get('panNumber');
                if (panNumber && !utils.validatePAN(panNumber)) {
                    errors.push('Invalid PAN number format');
                }

                // IFSC validation (optional)
                const ifscCode = formData.get('ifscCode');
                if (ifscCode && !utils.validateIFSC(ifscCode)) {
                    errors.push('Invalid IFSC code format');
                }

                // Rating validation
                const rating = formData.get('rating');
                if (rating && (isNaN(rating) || rating < 0 || rating > 5)) {
                    errors.push('Rating must be between 0 and 5');
                }

                // Total products validation
                const totalProducts = formData.get('totalProducts');
                if (totalProducts && (isNaN(totalProducts) || totalProducts < 0)) {
                    errors.push('Total products must be a positive number');
                }

                return errors;
            }
        };

        // Vendor Operations
        const vendorOperations = {
            loadVendors: async () => {
                const vendorList = document.getElementById('vendorList');
                const vendorCards = document.getElementById('vendorCards');

                if (!vendorList || !vendorCards) {
                    utils.showNotification('Vendor list elements not found', 'error');
                    return;
                }

                // Show loading state
                vendorCards.innerHTML = `
                    <div class="flex justify-center items-center py-12">
                        <div class="text-center">
                            <i class="fas fa-spinner animate-spin text-4xl text-gray-400 mb-4" aria-hidden="true"></i>
                            <p class="text-gray-500 text-lg">Loading vendors...</p>
                        </div>
                    </div>
                `;
                vendorList.classList.remove('hidden');

                try {
                    const snapshot = await db.collection('vendors')
                        .orderBy('updatedAt', 'desc')
                        .limit(50)
                        .get();

                    if (snapshot.empty) {
                        vendorCards.innerHTML = `
                            <div class="text-center py-12">
                                <i class="fas fa-store text-6xl text-gray-300 mb-4" aria-hidden="true"></i>
                                <p class="text-gray-500 text-xl">No vendors found</p>
                                <p class="text-gray-400">Create your first vendor above!</p>
                            </div>
                        `;
                        return;
                    }

                    vendorCards.innerHTML = '';
                    const fragment = document.createDocumentFragment();

                    snapshot.forEach(doc => {
                        const vendor = doc.data();
                        vendor.id = doc.id;
                        const vendorCard = vendorOperations.createVendorCard(vendor);
                        fragment.appendChild(vendorCard);
                    });

                    vendorCards.appendChild(fragment);
                    utils.showNotification(`Loaded ${snapshot.size} vendors`);

                } catch (error) {
                    console.error('Error loading vendors:', error);
                    vendorCards.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4" aria-hidden="true"></i>
                            <p class="text-red-500 text-xl">Error loading vendors</p>
                            <p class="text-red-400">Please check your connection and try again</p>
                            <button onclick="vendorOperations.loadVendors()" 
                                    class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                                Retry
                            </button>
                        </div>
                    `;
                    utils.showNotification(`Failed to load vendors: ${error.message}`, 'error');
                }
            },

            createVendorCard: (vendor) => {
                const card = document.createElement('div');
                card.className = 'bg-gray-50 rounded-2xl p-6 border-l-4 border-blue-500 hover:shadow-lg transition-all duration-200 transform hover:-translate-y-1';

                const safeVendor = {
                    name: utils.sanitizeInput(vendor.name) || 'N/A',
                    email: utils.sanitizeInput(vendor.email) || 'N/A',
                    phone: utils.sanitizeInput(vendor.phone) || 'N/A',
                    companyName: utils.sanitizeInput(vendor.companyName) || 'N/A',
                    gstNumber: utils.sanitizeInput(vendor.gstNumber) || 'N/A',
                    city: utils.sanitizeInput(vendor.city) || 'N/A',
                    vendorId: utils.sanitizeInput(vendor.vendorId) || vendor.id,
                    rating: Number(vendor.rating) || 0,
                    totalProducts: Number(vendor.totalProducts) || 0,
                    isActive: Boolean(vendor.isActive),
                    isVerified: Boolean(vendor.isVerified)
                };

                card.innerHTML = `
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-4">
                        <div class="mb-4 lg:mb-0">
                            <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">${safeVendor.name}</h3>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${safeVendor.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    <i class="fas fa-circle text-xs mr-1" aria-hidden="true"></i>${safeVendor.isActive ? 'Active' : 'Inactive'}
                                </span>
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${safeVendor.isVerified ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">
                                    <i class="fas fa-${safeVendor.isVerified ? 'check-circle' : 'clock'} text-xs mr-1" aria-hidden="true"></i>${safeVendor.isVerified ? 'Verified' : 'Unverified'}
                                </span>
                            </div>
                        </div>
                        <button type="button" onclick="vendorOperations.editVendor('${safeVendor.vendorId}')" 
                                class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 focus:ring-4 focus:ring-green-100 transition-all duration-200 transform hover:scale-105 flex items-center justify-center font-medium">
                            <i class="fas fa-edit mr-2" aria-hidden="true"></i>Edit Vendor
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Vendor ID</p>
                            <p class="text-gray-800 font-mono text-xs">${safeVendor.vendorId}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Email</p>
                            <p class="text-gray-800 truncate">${safeVendor.email}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Phone</p>
                            <p class="text-gray-800">${safeVendor.phone}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Company</p>
                            <p class="text-gray-800 truncate">${safeVendor.companyName}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">GST Number</p>
                            <p class="text-gray-800 font-mono text-xs">${safeVendor.gstNumber}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">City</p>
                            <p class="text-gray-800">${safeVendor.city}</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Rating</p>
                            <div class="flex items-center space-x-1">
                                <span class="text-yellow-500 font-bold">${safeVendor.rating.toFixed(1)}</span>
                                <div class="flex text-yellow-400" aria-label="Rating: ${safeVendor.rating} out of 5 stars">
                                    ${Array.from({length: 5}, (_, i) => 
                                        `<i class="fas fa-star ${i < Math.floor(safeVendor.rating) ? '' : 'text-gray-300'}" aria-hidden="true"></i>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                        <div class="space-y-1">
                            <p class="text-gray-500 font-medium">Products</p>
                            <p class="text-gray-800 font-semibold">${safeVendor.totalProducts}</p>
                        </div>
                    </div>
                `;

                return card;
            },

            editVendor: async (vendorId) => {
                if (!vendorId) {
                    utils.showNotification('Invalid vendor ID', 'error');
                    return;
                }

                try {
                    const doc = await db.collection('vendors').doc(vendorId).get();
                    if (doc.exists) {
                        const vendor = doc.data();
                        vendor.vendorId = doc.id;
                        formManager.populateForm(vendor);

                        // Scroll to form
                        const formSection = document.querySelector('.bg-gray-50.rounded-2xl');
                        if (formSection) {
                            formSection.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'start' 
                            });
                        }
                    } else {
                        utils.showNotification('Vendor not found', 'error');
                    }
                } catch (error) {
                    console.error('Error loading vendor:', error);
                    utils.showNotification(`Error loading vendor: ${error.message}`, 'error');
                }
            },
/*
            saveVendor: async (vendorData) => {
                try {
                    const now = firebase.firestore.Timestamp.now();

                    // Check for duplicate email (excluding current vendor if editing)
                    const emailQuery = await db.collection('vendors')
                        .where('email', '==', vendorData.email)
                        .get();

                    const hasDuplicate = emailQuery.docs.some(doc => {
                        return doc.id !== (editingVendorId || '');
                    });

                    if (hasDuplicate) {
                        utils.showNotification('A vendor with this email already exists', 'error');
                        return false;
                    }

                    if (editingVendorId) {
                        // Update existing vendor
                        delete vendorData.password; // Don't update password in edit mode
                        vendorData.updatedAt = now;
                        
                        await db.collection('vendors').doc(editingVendorId).update(vendorData);
                        utils.showNotification('Vendor updated successfully!');
                    } else {
                        // Create new vendor
                        vendorData.createdAt = now;
                        vendorData.updatedAt = now;
                        vendorData.vendorId = utils.generateVendorId();
                        
                        // Hash password if provided
                        if (vendorData.password) {
                            vendorData.passwordHash = await utils.hashPassword(vendorData.password);
                            delete vendorData.password;
                            vendorData.hasPassword = true;
                        }

                        await db.collection('vendors').add(vendorData);
                        utils.showNotification('Vendor created successfully!');
                    }

                    return true;
                } catch (error) {
                    console.error('Error saving vendor:', error);
                    if (error.code === 'permission-denied') {
                        utils.showNotification('Permission denied. Please check your access rights.', 'error');
                    } else if (error.code === 'unavailable') {
                        utils.showNotification('Service temporarily unavailable. Please try again.', 'error');
                    } else {
                        utils.showNotification(`Error saving vendor: ${error.message}`, 'error');
                    }
                    return false;
                }
            }

*/

saveVendor: async (vendorData) => {
    try {
        const now = firebase.firestore.Timestamp.now();

        // Check for duplicate email (excluding current vendor if editing)
        const emailQuery = await db.collection('vendors')
            .where('email', '==', vendorData.email)
            .get();

        const hasDuplicate = emailQuery.docs.some(doc => {
            return doc.id !== (editingVendorId || '');
        });

        if (hasDuplicate) {
            utils.showNotification('A vendor with this email already exists', 'error');
            return false;
        }

        if (editingVendorId) {
            // Update existing vendor
            delete vendorData.password; // Don't update password in edit mode
            vendorData.updatedAt = now;
            
            await db.collection('vendors').doc(editingVendorId).update(vendorData);
            utils.showNotification('Vendor updated successfully!');
        } else {
            // Create new vendor
            vendorData.createdAt = now;
            vendorData.updatedAt = now;
            vendorData.vendorId = utils.generateVendorId();
            
            // Hash password if provided
            if (vendorData.password) {
                vendorData.passwordHash = await utils.hashPassword(vendorData.password);
                delete vendorData.password;
                vendorData.hasPassword = true;
            }

            // Add vendor and get doc ID
            const vendorRef = await db.collection('vendors').add(vendorData);
            const vendorDocId = vendorRef.id; // Firestore doc ID for vendor
            utils.showNotification('Vendor created successfully!');

            // ---- Add new user in 'users' collection ----
            const name = document.getElementById('name')?.value?.trim() || '';
            const username = document.getElementById('username')?.value?.trim() || '';
            const password = document.getElementById('password')?.value?.trim() || '';
            const phone = document.getElementById('phone')?.value?.trim() || '';

            if (name && username && password && phone) {
                // Get next ID (simple approach — could be optimized for concurrency)
                const usersSnapshot = await db.collection('users').get();
                const newUserId = usersSnapshot.size + 1;

                const userDoc = {
                    id: newUserId,
                    name,
                    username,
                    phone,
		    role: 'vendor',
		    isActive: 'active',
                    vendorId: vendorDocId, // Link vendor's doc ID
                    createdAt: now
                };

                // Hash password
                userDoc.password = await utils.hashPassword(password);

                // Save user
                await db.collection('users').doc(String(newUserId)).set(userDoc);

                utils.showNotification(`User ${username} created with ID ${newUserId}`);
            } else {
                utils.showNotification('User fields are missing. User not created.', 'warning');
            }

            // ---- Create log entry ----
            const currentUserId = sessionStorage.getItem('userId') || 'unknown';

            await db.collection('logs').add({
                action: "create",
                changes: null,
                entityId: vendorDocId.toString(), // vendor doc ID
                entityType: "vendor",
                note: `Vendor Created with vendor ID No. ${vendorDocId} by User id No. ${currentUserId}`,
                sessionId: "true", // Same as your existing logs
                timestamp: new Date(),
                url: window.location.href,
                userAgent: navigator.userAgent
            });
        }

        return true;
    } catch (error) {
        console.error('Error saving vendor:', error);
        if (error.code === 'permission-denied') {
            utils.showNotification('Permission denied. Please check your access rights.', 'error');
        } else if (error.code === 'unavailable') {
            utils.showNotification('Service temporarily unavailable. Please try again.', 'error');
        } else {
            utils.showNotification(`Error saving vendor: ${error.message}`, 'error');
        }
        return false;
    }
}



        };

        // Event Listeners Setup
        const setupEventListeners = () => {
            const vendorForm = document.getElementById('vendorForm');
            if (vendorForm) {
                vendorForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    if (isFormSubmitting) {
                        utils.showNotification('Please wait, form is being submitted...', 'error');
                        return;
                    }

                    isFormSubmitting = true;
                    const submitBtn = document.querySelector('button[type="submit"]');
                    const originalBtnContent = submitBtn.innerHTML;
                    
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner animate-spin mr-3" aria-hidden="true"></i>Saving...';
                    }

                    try {
                        const formData = new FormData(e.target);

                        // Validate form
                        const errors = formManager.validateForm(formData);
                        if (errors.length > 0) {
                            utils.showNotification(errors[0], 'error');
                            return;
                        }

                        // Prepare vendor data
                        const vendorData = {};

                        for (let [key, value] of formData.entries()) {
                            if (key === 'deliveryZones' && value) {
                                vendorData.deliveryZones = value.split(',').map(zone => utils.sanitizeInput(zone.trim())).filter(zone => zone);
                            } else if (value !== '') {
                                vendorData[key] = utils.sanitizeInput(value);
                            }
                        }

                        // Handle checkboxes
                        vendorData.isActive = formData.has('isActive');
                        vendorData.isVerified = formData.has('isVerified');
                        vendorData.paymentVerified = formData.has('paymentVerified');

                        // Convert numeric fields
                        if (vendorData.rating) vendorData.rating = Math.max(0, Math.min(5, parseFloat(vendorData.rating)));
                        if (vendorData.totalProducts) vendorData.totalProducts = Math.max(0, parseInt(vendorData.totalProducts));

                        const success = await vendorOperations.saveVendor(vendorData);

                        if (success) {
                            formManager.clearForm();

                            // Refresh vendor list if visible
                            const vendorList = document.getElementById('vendorList');
                            if (vendorList && !vendorList.classList.contains('hidden')) {
                                await vendorOperations.loadVendors();
                            }
                        }

                    } catch (error) {
                        console.error('Form submission error:', error);
                        utils.showNotification('An unexpected error occurred. Please try again.', 'error');
                    } finally {
                        isFormSubmitting = false;
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = originalBtnContent;
                        }
                    }
                });
            }

            // Input validation setup
            const setupInputValidation = (id, validator, formatter) => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', utils.debounce((e) => {
                        let value = e.target.value;

                        if (formatter) {
                            value = formatter(value);
                            e.target.value = value;
                        }

                        if (value && validator && !validator(value)) {
                            e.target.classList.remove('border-green-500');
                            e.target.classList.add('border-red-500');
                        } else if (value) {
                            e.target.classList.remove('border-red-500');
                            e.target.classList.add('border-green-500');
                        } else {
                            e.target.classList.remove('border-red-500', 'border-green-500');
                            e.target.classList.add('border-gray-200');
                        }
                    }, 300));
                }
            };

            // Setup field validations
            setupInputValidation('gstNumber', utils.validateGST, (value) => 
                value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 15)
            );
            setupInputValidation('panNumber', utils.validatePAN, (value) => 
                value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 10)
            );
            setupInputValidation('ifscCode', utils.validateIFSC, (value) => 
                value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 11)
            );
            setupInputValidation('phone', utils.validatePhone, (value) => 
                value.replace(/[^0-9+\-\s]/g, '')
            );
            setupInputValidation('email', utils.validateEmail);

            // Required field validation on blur
            document.querySelectorAll('input[required]').forEach(input => {
                input.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.classList.remove('border-green-500');
                        this.classList.add('border-red-500');
                    } else {
                        this.classList.remove('border-red-500');
                        this.classList.add('border-green-500');
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const form = document.getElementById('vendorForm');
                    if (form && !isFormSubmitting) {
                        form.dispatchEvent(new Event('submit'));
                    }
                }
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    formManager.clearForm();
                }
            });
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize Firebase
                if (!initializeFirebase()) {
                    throw new Error('Firebase initialization failed');
                }

                // Set default country
                const countrySelect = document.getElementById('country');
                if (countrySelect) {
                    countrySelect.value = 'IN';
                }

                // Setup event listeners
                setupEventListeners();

                utils.showNotification('Vendor Management System initialized successfully');

            } catch (error) {
                console.error('Initialization error:', error);
                utils.showNotification('System initialization failed. Please refresh the page.', 'error');
            }
        });

        // Global functions for button onclick handlers
        window.vendorOperations = vendorOperations;
        window.formManager = formManager;
        window.utils = utils;

        // Error handling for uncaught errors
        window.addEventListener('error', (event) => {
            console.error('Uncaught error:', event.error);
            utils.showNotification('An unexpected error occurred', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            utils.showNotification('An unexpected error occurred', 'error');
            event.preventDefault();
        });


// to hide urlParam
window.addEventListener('DOMContentLoaded', () => {
    if (window.location.search) {
        // Remove query parameters
        const cleanURL = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, cleanURL);
    }
});
    </script>
</body>
</html>